#!/bin/bash

# Space Debris Risk Model API Startup Script
echo "ğŸ›°ï¸  Starting Space Debris Risk Model API..."

# Create and activate virtual environment
echo "Setting up Python virtual environment..."
python3 -m venv .venv

# Check if virtual environment was created successfully
if [ ! -d ".venv" ]; then
    echo "âŒ Failed to create virtual environment"
    exit 1
fi

source .venv/bin/activate

# Check if activation was successful
if [ -z "$VIRTUAL_ENV" ]; then
    echo "âŒ Failed to activate virtual environment"
    exit 1
fi

echo "âœ… Virtual environment activated: $VIRTUAL_ENV"

# Install dependencies
echo "Installing Python dependencies..."
if pip install -r requirements.txt; then
    echo "âœ… Dependencies installed successfully"
else
    echo "âŒ Failed to install dependencies"
    exit 1
fi

# Set environment variables for development
export ENVIRONMENT=development
export DEBUG=true
export PYTHONPATH="${PYTHONPATH}:$(pwd)"

# Check if .env file exists and source it
if [ -f ".env" ]; then
    echo "Loading environment variables from .env file..."
    source .env
fi

# Start the API server
echo "ğŸš€ Starting FastAPI server..."
echo "ğŸ“¡ API will be available at: http://localhost:8000"
echo "ğŸ“š Interactive API docs at: http://localhost:8000/docs"
echo "ğŸ“‹ ReDoc documentation at: http://localhost:8000/redoc"
echo ""
echo "Press Ctrl+C to stop the server"

uvicorn main:app --reload --port 8000 --host 0.0.0.0